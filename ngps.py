import pkg_resources
import os
import numpy as np


class NGPS:
    """Units are Angstroms or Angstroms/pixel
    order is u, g, r, i
    """
    n_det = 4
    pix_size_microns = 15.0
    det_colors = ["blue", "green", "red", "orange"]
    det_bands = ["u", "g", "r", "i"]
    det_readnoise = [2.5, 3.5, 3.5, 3.5]
    det_gain = [1., 1., 1., 1.]
    det_gain_cal = [2.5, 2.5, 2.5, 2.5]

    detector_wave_limits = [[3100., 4360.], [4170., 5900.],
                            [5610., 7940.], [7560., 10400.]]
    detector_central_waves = [3970., 5070., 6805., 8905.]
    detector_wave_ranges = [1260., 1730., 2330., 2840.]
    detector_dispersions = [0.31, 0.42, 0.57, 0.69]
    detector_delta_waves = [0.83, 1.14, 1.54, 1.87]
    detector_npix = [4085, 4081, 4073, 4073]
    detector_disp_coeffs = [
        [3100.0, 0.31419853, 2.6566093e-06, -1.0772853e-09, 2.8034887e-14,
         -1.7740431e-18],   # u-band A/px
        [5899.9998, -0.40259936, -7.5791344e-06, 4.8458524e-10, 3.7826880e-14,
         -3.8105895e-18],   # g-band A/px
        [5610.0003, 0.59473055, -5.5128656e-06, 1.7818296e-10, -5.5768936e-14,
         2.4585027e-18],    # r-band A/px
        [10400.000, -0.66393741, -9.3546052e-06, 4.0666771e-10, -3.3153715e-14,
         7.5232832e-19]     # i-band A/px
    ]
    # resolution function
    seg_waves = [
        [3100., 3226., 3352., 3478., 3604.,
         3730., 3856., 3982., 4108., 4234., 4360.],
        [4170., 4343., 4516., 4689., 4862.,
         5035., 5208., 5381., 5554., 5727., 5900.],
        [5610., 5843., 6076., 6309., 6542.,
         6775., 7008., 7241., 7474., 7707., 7940.],
        [7560., 7844., 8128., 8412., 8696.,
         8980., 9264., 9548., 9832., 10116., 10400.]
    ]
    slit_pix = [
        [2.7581, 2.7372, 2.7263, 2.7247, 2.7320,
         2.7481, 2.7732, 2.8081, 2.8536, 2.9115, 2.9840],
        [2.7448, 2.7424, 2.7442, 2.7504, 2.7612,
         2.7769, 2.7976, 2.8235, 2.8549, 2.8922, 2.9357],
        [2.7031, 2.7147, 2.7278, 2.7424, 2.7587,
         2.7768, 2.7968, 2.8190, 2.8434, 2.8705, 2.9006],
        [2.6960, 2.7113, 2.7281, 2.7464, 2.7662,
         2.7876, 2.8107, 2.8356, 2.8627, 2.8923, 2.9248]
    ]
    spot_size_microns = [
        [7.8374, 8.7062, 7.2498, 5.5818, 6.0024,
         7.2574, 8.1242, 9.0354, 10.0514, 9.1394, 4.9808],
        [6.8040, 6.7946, 7.9442, 7.2500, 6.8286,
         7.7074, 8.9690, 9.5502, 9.0346, 7.6950, 6.9704],
        [5.2212, 5.0274, 5.5942, 5.3080, 6.1034,
         7.5004, 8.2442, 7.8060, 6.1742, 3.6198, 4.1532],
        [4.4700, 4.0422, 5.2198, 6.0026, 6.7150,
         7.1846, 7.1586, 6.6496, 5.8196, 4.6316, 4.5122]
    ]
    thrpt = None

    def read_thrpt(self):
        # path to atlas for input lamp
        path = "data/thrpt.csv"
        pkg = __name__.split('.')[0]
        tpath = pkg_resources.resource_filename(pkg, path)

        # verify path
        if os.path.exists(tpath):
            print("Reading throughput data in: %s" % tpath)
        else:
            print("ERROR: Throughput data not found in %s" % tpath)

        tdata = np.genfromtxt(tpath, delimiter=',')

        self.thrpt = tdata

